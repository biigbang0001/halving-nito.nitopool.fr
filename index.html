<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nito Halving Countdown</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .brand{position:fixed;top:16px;left:16px;z-index:10;display:flex;align-items:center;gap:10px;opacity:.95}
    .brand img{width:64px;height:64px;display:block}
    .brand a{color:#ffeb3b;text-decoration:none;font-weight:bold;font-size:14px}
    .brand a:hover{text-decoration:underline}
    .container{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:20px;padding:32px;text-align:center;box-shadow:0 8px 32px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.2);max-width:980px;width:100%}
    h1{font-size:2.4rem;text-shadow:2px 2px 4px rgba(0,0,0,.3);margin-bottom:8px}
    .subtitle{opacity:.85;margin-bottom:24px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin-bottom:24px}
    .card{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.2);border-radius:14px;padding:16px}
    .card h3{font-size:1rem;opacity:.9;margin-bottom:8px}
    .value{font-size:1.8rem;font-weight:bold;color:#ffeb3b}
    .countdown{margin:28px 0 8px}
    .countdown h2{font-size:1.4rem;margin-bottom:14px;opacity:.95}
    .time-grid{display:grid;grid-template-columns:repeat(4,minmax(90px,1fr));gap:12px;margin-bottom:18px}
    .time-box{background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);border-radius:10px;padding:12px}
    .time-num{display:block;font-size:1.8rem;font-weight:700;color:#4fc3f7}
    .time-lbl{font-size:.9rem;opacity:.85}
    .progress{height:18px;background:rgba(255,255,255,.2);border-radius:10px;overflow:hidden;margin-bottom:12px}
    .progress>div{height:100%;background:linear-gradient(90deg,#4fc3f7,#29b6f6);width:2px;min-width:2px;transition:width .25s linear}
    .status{font-size:1rem;margin:10px 0 18px;padding:10px;border-radius:8px;background:rgba(76,175,80,.2)}
    .status.warning{background:rgba(255,193,7,.2);color:#ffc107}
    .status.urgent{background:rgba(244,67,54,.2);color:#f44336;animation:pulse 2s infinite}
    @keyframes pulse{0%{opacity:1}50%{opacity:.72}100%{opacity:1}}
    .links{margin-top:18px;text-align:left}
    .links h3{margin-bottom:12px}
    .links-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
    .link-card{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.2);border-radius:12px;padding:14px;transition:transform .2s ease,background .2s ease}
    .link-card:hover{transform:translateY(-2px);background:rgba(255,255,255,.25)}
    .link-card a{color:#4fc3f7;text-decoration:none;font-weight:700;display:block;margin-bottom:6px}
    .link-card a:hover{color:#29b6f6}
    .link-desc{font-size:.9rem;opacity:.85}
    .foot{margin-top:12px;font-size:.92rem;opacity:.8}
    .error{color:#ff5252;background:rgba(255,82,82,.12);padding:12px;border-radius:10px;margin:16px 0 0;display:none}
    @media (max-width:640px){.time-grid{grid-template-columns:repeat(2,minmax(90px,1fr))}.links-grid{grid-template-columns:1fr}.brand img{width:48px;height:48px}}
  </style>
</head>
<body>
  <div class="brand">
    <a href="https://nito.network/" target="_blank" rel="noopener"><img src="https://raw.githubusercontent.com/biigbang0001/wallet-nito/master/nito.png" alt="NITO logo"/></a>
    <a href="https://nito.network/" target="_blank" rel="noopener">Nito Network</a>
  </div>

  <div class="container">
    <h1>üöÄ Nito Halving Countdown</h1>
    <div class="subtitle"></div>

    <div class="grid">
      <div class="card"><h3>Current Block</h3><div class="value" id="v_block">-</div></div>
      <div class="card"><h3>Next Halving Block</h3><div class="value" id="v_next">-</div></div>
      <div class="card"><h3>Current Reward</h3><div class="value" id="v_reward_now">-</div></div>
      <div class="card"><h3>Next Reward</h3><div class="value" id="v_reward_next">-</div></div>
    </div>

    <div class="grid">
      <div class="card"><h3>Network Difficulty</h3><div class="value" id="v_diff">-</div></div>
      <div class="card"><h3>Circulating Supply</h3><div class="value" id="v_supply">-</div></div>
      <div class="card"><h3>Network Hashrate</h3><div class="value" id="v_hash">-</div></div>
      <div class="card"><h3>Blocks Remaining</h3><div class="value" id="v_remaining">-</div></div>
    </div>

    <div class="countdown">
      <h2>Estimated Time to Halving</h2>
      <div class="time-grid">
        <div class="time-box"><span class="time-num" id="t_days">0</span><span class="time-lbl">Days</span></div>
        <div class="time-box"><span class="time-num" id="t_hours">0</span><span class="time-lbl">Hours</span></div>
        <div class="time-box"><span class="time-num" id="t_minutes">0</span><span class="time-lbl">Minutes</span></div>
        <div class="time-box"><span class="time-num" id="t_seconds">0</span><span class="time-lbl">Seconds</span></div>
      </div>
    </div>

    <div class="progress"><div id="progress"></div></div>
    <div class="status" id="status">Updating‚Ä¶</div>

    <div class="links">
      <h3>üîó Useful Links</h3>
      <div class="links-grid">
        <div class="link-card"><a href="https://nito.network/" target="_blank" rel="noopener">üåê Nito Network Official</a><div class="link-desc">Project website & docs</div></div>
        <div class="link-card"><a href="https://explorer.nito.network/" target="_blank" rel="noopener">üîé Nito Official Explorer</a><div class="link-desc">Blocks, transactions & addresses</div></div>
        <div class="link-card"><a href="https://nito-explorer.nitopool.fr/" target="_blank" rel="noopener">üß≠ NitoPool Explorer</a><div class="link-desc">Pool explorer & stats</div></div>
        <div class="link-card"><a href="https://www.livecoinwatch.com/price/NitoCoin-_NITO" target="_blank" rel="noopener">üìà NITO Price (LiveCoinWatch)</a><div class="link-desc">Live price and market data</div></div>
      </div>
    </div>

    <div class="foot">Last update: <span id="lastUpdate">-</span></div>
    <div class="error" id="error"></div>
  </div>

  <script>
    const API_URL='/nito_summary.php';
    const FETCH_DEFAULT_MS=15000;
    const FETCH_NEAR_MS=10000;
    const NEAR_THRESHOLD=100;

    const $=id=>document.getElementById(id);
    const fmtInt=n=>Number(n||0).toLocaleString();
    const fmtInt0=n=>Math.round(Number(n||0)).toLocaleString();
    const fmtClock=ms=>{try{return new Date(ms).toLocaleTimeString(undefined,{hour12:false})}catch{return'-'}};

    let S={block:0,nextHalvingBlock:0,currentReward:512,nextReward:256,supply:0,difficulty:0,hashrate:{human:'-'},blocksRemaining:0,blockTimeSec:60,as_of_ms:0,targetHalvingTs:0};
    let fetchTimer=null,currentFetchMS=FETCH_DEFAULT_MS;

    function renderStatic(){
      $('v_block').textContent=fmtInt(S.block);
      $('v_next').textContent=fmtInt(S.nextHalvingBlock);
      $('v_reward_now').textContent=S.currentReward+' NITO';
      $('v_reward_next').textContent=S.nextReward+' NITO';
      $('v_diff').textContent=fmtInt0(S.difficulty);$('v_diff').title=String(S.difficulty);
      $('v_supply').textContent=fmtInt0(S.supply);$('v_supply').title=String(S.supply);
      $('v_hash').textContent=(S.hashrate&&S.hashrate.human)?S.hashrate.human:'-';
      $('v_remaining').textContent=fmtInt(S.blocksRemaining);
      $('lastUpdate').textContent=S.as_of_ms?fmtClock(S.as_of_ms):'-';

      const prevHalving = (function(h){
        const arr=[0,525600,1051200,1576800,5256000,10512000,26280000,105120000];
        let p=0; for(const x of arr){ if(x<=h)p=x; else break } return p;
      })(S.block);
      const spanTotal = Math.max(1,(S.nextHalvingBlock - prevHalving));
      const spanDone  = Math.max(0,(S.block - prevHalving));
      const pct = Math.max(0,Math.min(100,100*spanDone/spanTotal));
      $('progress').style.width = pct + '%';
    }

    function renderTimer(){
      const now = Date.now();
      let remain = Math.max(0, Math.floor((S.targetHalvingTs - now)/1000));
      const d=Math.floor(remain/86400);
      const h=Math.floor((remain%86400)/3600);
      const m=Math.floor((remain%3600)/60);
      const s=Math.floor(remain%60);
      $('t_days').textContent=d; $('t_hours').textContent=h; $('t_minutes').textContent=m; $('t_seconds').textContent=s;

      const blocksRemaining = Math.max(0, Math.ceil(remain / S.blockTimeSec));
      $('v_remaining').textContent = fmtInt(blocksRemaining);

      if(blocksRemaining<=0){ setStatus('üéâ Halving complete! Updating‚Ä¶'); resched(FETCH_NEAR_MS) }
      else if(blocksRemaining<=10){ setStatus(`‚ö° URGENT: Only ${blocksRemaining} blocks remaining! (refreshing every 10s)`,'urgent'); resched(FETCH_NEAR_MS) }
      else if(blocksRemaining<=NEAR_THRESHOLD){ setStatus(`‚ö†Ô∏è Close to halving: ${blocksRemaining} blocks remaining`,'warning'); resched(FETCH_NEAR_MS) }
      else{ setStatus(`‚úÖ ${fmtInt(blocksRemaining)} blocks until next halving`); resched(FETCH_DEFAULT_MS) }
    }

    function setStatus(t,cls){const el=$('status');el.textContent=t;el.className='status'+(cls?' '+cls:'')}

    function applyServerData(d){
      S.block            = Number(d.block)||0;
      S.nextHalvingBlock = Number(d.nextHalvingBlock)||0;
      S.currentReward    = Number(d.currentReward)||512;
      S.nextReward       = Number(d.nextReward)||256;
      S.supply           = Number(d.supply)||0;
      S.difficulty       = Number(d.difficulty)||0;
      S.hashrate         = d.hashrate||{human:'-'};
      S.blocksRemaining  = Number(d.blocksRemaining)||0;
      S.blockTimeSec     = Number(d.blockTimeSec)||60;
      S.as_of_ms         = Number(d.as_of_ms||d.serverTime)||Date.now();
      S.targetHalvingTs  = Number(d.targetHalvingTs)|| (S.as_of_ms + S.blocksRemaining*S.blockTimeSec*1000);
      renderStatic();
      renderTimer();
      hideError();
    }

    async function fetchOnce(){
      try{
        const r=await fetch(API_URL+'?ts='+Date.now(),{cache:'no-store'});
        if(!r.ok)throw new Error('Bad response ('+r.status+')');
        const j=await r.json();
        applyServerData(j);
      }catch(e){showError('Connection error: '+e.message)}
    }

    function resched(ms){ if(currentFetchMS===ms) return; currentFetchMS=ms; if(fetchTimer) clearInterval(fetchTimer); fetchTimer=setInterval(fetchOnce,currentFetchMS) }
    function showError(m){const el=$('error');el.textContent=m;el.style.display='block'}
    function hideError(){$('error').style.display='none'}

    (function init(){ fetchOnce(); setInterval(renderTimer,1000); resched(FETCH_DEFAULT_MS) })();
  </script>
</body>
</html>
