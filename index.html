<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nito Halving Countdown</title>
  
  <!-- Favicon (ic√¥ne dans l'onglet du navigateur) -->
  <link rel="icon" type="image/png" href="https://github.com/biigbang0001/halving-nito.nitopool.fr/blob/main/nito.png?raw=true">
  
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px
    }
    .logo{
      position:fixed;top:16px;left:16px;width:56px;height:auto;image-rendering:auto;
      pointer-events:none;user-select:none;filter:drop-shadow(0 2px 4px rgba(0,0,0,.3))
    }
    .container{
      background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border-radius:20px;padding:32px;
      text-align:center;box-shadow:0 8px 32px rgba(0,0,0,.3);border:1px solid rgba(255,255,255,.2);
      max-width:1000px;width:100%
    }
    h1{font-size:2.4em;text-shadow:2px 2px 4px rgba(0,0,0,.3);margin-bottom:10px}
    .current-info{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin:24px 0 28px
    }
    .info-card{
      background:rgba(255,255,255,.15);padding:16px;border-radius:14px;border:1px solid rgba(255,255,255,.22)
    }
    .info-card h3{font-size:1.02em;margin-bottom:6px;opacity:.9}
    .value{font-size:1.5em;font-weight:700;color:#ffeb3b}
    .countdown{margin:18px 0 8px}
    .countdown h2{font-size:1.5em;margin-bottom:14px;opacity:.95}
    .time-display{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(110px,1fr));gap:12px;margin-bottom:14px
    }
    .time-unit{background:rgba(255,255,255,.2);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.3)}
    .time-number{font-size:1.8em;font-weight:700;display:block;color:#4fc3f7}
    .time-label{font-size:.9em;opacity:.85}
    .progress-bar{background:rgba(255,255,255,.2);height:16px;border-radius:10px;overflow:hidden;margin:16px 0}
    .progress-fill{background:linear-gradient(90deg,#4fc3f7,#29b6f6);height:100%;border-radius:10px;transition:width .5s ease;min-width:2px}
    .status{font-size:1.05em;margin:12px 0 6px;padding:10px;border-radius:8px;background:rgba(76,175,80,.22)}
    .status.warning{background:rgba(255,193,7,.22);color:#ffc107}
    .status.urgent{background:rgba(244,67,54,.22);color:#f44336;animation:pulse 2s infinite}
    @keyframes pulse{0%{opacity:1}50%{opacity:.7}100%{opacity:1}}
    .links-section{margin-top:20px;padding:16px;background:rgba(255,255,255,.1);border-radius:15px;border-left:4px solid #ffeb3b}
    .links-section h3{margin-bottom:12px;font-size:1.2em}
    .links-grid{display:grid;grid-template-columns:repeat(2,minmax(220px,1fr));gap:12px}
    .link-card{background:rgba(255,255,255,.15);padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,.2);transition:all .25s ease}
    .link-card:hover{background:rgba(255,255,255,.25);transform:translateY(-2px)}
    .link-card a{color:#4fc3f7;text-decoration:none;font-weight:700;display:block;margin-bottom:4px}
    .link-card a:hover{color:#29b6f6}
    .link-description{font-size:.9em;opacity:.85}
    .halving-info{margin-top:18px;padding:14px;background:rgba(255,255,255,.1);border-radius:15px;border-left:4px solid #4fc3f7}
    .error{color:#ff5252;background:rgba(255,82,82,.12);padding:12px;border-radius:10px;margin:14px 0;display:none}
    .last-update{font-size:.95em;opacity:.85;margin-top:14px}
    @media (max-width:600px){
      .links-grid{grid-template-columns:1fr}
      .logo{width:48px}
    }
  </style>
</head>
<body>
  <img class="logo" src="https://github.com/biigbang0001/halving-nito.nitopool.fr/blob/main/nito.png?raw=true" alt="NITO"/>

  <div class="container">
    <h1>üöÄ Nito Halving Countdown</h1>

    <div class="current-info">
      <div class="info-card"><h3>Current Block</h3><div class="value" id="currentBlock">-</div></div>
      <div class="info-card"><h3>Next Halving Block</h3><div class="value" id="nextHalvingBlock">-</div></div>
      <div class="info-card"><h3>Current Reward</h3><div class="value" id="currentReward">-</div></div>
      <div class="info-card"><h3>Next Reward</h3><div class="value" id="nextReward">-</div></div>
      <div class="info-card"><h3>Network Difficulty</h3><div class="value" id="difficulty">-</div></div>
      <div class="info-card"><h3>Circulating Supply</h3><div class="value" id="supply">-</div></div>
      <div class="info-card"><h3>Network Hashrate</h3><div class="value" id="hashrate">-</div></div>
    </div>

    <div class="countdown">
      <h2>Estimated Time to Halving</h2>
      <div class="time-display">
        <div class="time-unit"><span class="time-number" id="days">0</span><span class="time-label">Days</span></div>
        <div class="time-unit"><span class="time-number" id="hours">0</span><span class="time-label">Hours</span></div>
        <div class="time-unit"><span class="time-number" id="minutes">0</span><span class="time-label">Minutes</span></div>
        <div class="time-unit"><span class="time-number" id="seconds">0</span><span class="time-label">Seconds</span></div>
      </div>
    </div>

    <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
    <div id="status" class="status">Updating‚Ä¶</div>

    <div class="halving-info">
      <h3>üìä Halving Information</h3>
      <p id="halvingDescription">Loading‚Ä¶</p>
    </div>

    <div class="links-section">
      <h3>üîó Useful Links</h3>
      <div class="links-grid">
        <div class="link-card">
          <a href="https://nito.network/" target="_blank" rel="noopener noreferrer">üåê Nito Network Official</a>
          <div class="link-description">Official website</div>
        </div>
        <div class="link-card">
          <a href="https://explorer.nito.network/" target="_blank" rel="noopener noreferrer">üß≠ Nito Explorer</a>
          <div class="link-description">Blockchain explorer</div>
        </div>
        <div class="link-card">
          <a href="https://www.livecoinwatch.com/price/NitoCoin-_NITO" target="_blank" rel="noopener noreferrer">üìà NITO Price</a>
          <div class="link-description">Live market data</div>
        </div>
        <div class="link-card">
          <a href="https://rabid-rabbit.org/account/trade/NITO-USDT" target="_blank" rel="noopener noreferrer">üí± Trade NITO/USDT</a>
          <div class="link-description">Exchange</div>
        </div>
      </div>
    </div>

    <div class="last-update">Last update: <span id="lastUpdate">-</span></div>
    <div id="error" class="error"></div>
  </div>

  <script>
    const API_URL = '/nito_summary.php';
    const REFRESH_DEFAULT = 10000;
    const REFRESH_NEAR = 10000;

    let timer = null;
    let refresh = 0;

    let serverSkewMs = 0;
    let targetHalvingTs = 0;
    let blocksRemaining = 0;
    let progressPct = 0;
    let descText = '';

    function fmtInt(n){ return Number(Math.round(n)).toLocaleString(); }
    function el(id){ return document.getElementById(id); }

    function resched(ms){
      if (timer && refresh === ms) return;
      refresh = ms;
      if (timer) clearInterval(timer);
      timer = setInterval(fetchOnce, refresh);
    }

    async function fetchOnce(){
      try{
        const r = await fetch(API_URL + '?ts=' + Date.now(), {
          cache: 'no-store',
          headers: { 'Cache-Control': 'no-cache' }
        });
        if(!r.ok) throw new Error('HTTP ' + r.status);
        const j = await r.json();
        applyServer(j);
      }catch(e){
        showError('Connection error: ' + e.message);
      }
    }

    function applyServer(j){
      hideError();

      const srvNow = j.serverTime || j.as_of_ms || Date.now();
      serverSkewMs = Date.now() - srvNow;

      el('currentBlock').textContent     = Number(j.block).toLocaleString();
      el('nextHalvingBlock').textContent = Number(j.nextHalvingBlock).toLocaleString();
      el('currentReward').textContent    = j.currentReward + ' NITO';
      el('nextReward').textContent       = j.nextReward + ' NITO';

      el('difficulty').textContent = fmtInt(j.difficulty);
      el('supply').textContent     = fmtInt(j.supply);
      el('hashrate').textContent   = (j.hashrate && j.hashrate.human) ? j.hashrate.human : '-';

      blocksRemaining = j.blocksRemaining ?? Math.max(0, (j.nextHalvingBlock||0) - (j.block||0));
      progressPct     = Math.max(0, Math.min(100, j.progressPct ?? 0));
      targetHalvingTs = j.targetHalvingTs || 0;

      el('progressFill').style.width = progressPct + '%';

      if (blocksRemaining <= 0){
        el('status').className = 'status';
        el('status').textContent = 'üéâ Halving complete! Updating‚Ä¶';
        resched(REFRESH_DEFAULT);
      } else if (blocksRemaining <= 10){
        el('status').className = 'status urgent';
        el('status').textContent = '‚ö° URGENT: Only ' + blocksRemaining + ' blocks remaining! (Updating every 10s)';
        resched(REFRESH_NEAR);
      } else if (blocksRemaining <= 100){
        el('status').className = 'status warning';
        el('status').textContent = '‚ö†Ô∏è Close to halving: ' + blocksRemaining + ' blocks remaining';
        resched(REFRESH_DEFAULT);
      } else {
        el('status').className = 'status';
        el('status').textContent = '‚úÖ ' + Number(blocksRemaining).toLocaleString() + ' blocks until next halving';
        resched(REFRESH_DEFAULT);
      }

      descText = halvingDesc(j.currentReward, j.nextReward);
      el('halvingDescription').textContent = descText;

      const asOf = new Date(j.as_of_ms || j.serverTime || Date.now());
      el('lastUpdate').textContent = asOf.toLocaleTimeString();

      renderTimer();
    }

    function halvingDesc(cur, next){
      const map = {
        '512-256': 'First halving (512 ‚Üí 256 Nito)',
        '256-128': 'Second halving (256 ‚Üí 128 Nito)',
        '128-64' : 'Third halving (128 ‚Üí 64 Nito)',
        '64-32'  : 'Fourth halving (64 ‚Üí 32 Nito)',
        '32-8'   : 'Fifth halving (32 ‚Üí 8 Nito)',
        '8-2'    : 'Sixth halving (8 ‚Üí 2 Nito)',
        '2-0'    : 'Seventh halving (2 ‚Üí 0 Nito)'
      };
      return map[`${cur}-${next}`] || 'Next reward update';
    }

    function renderTimer(){
      if (!targetHalvingTs){ setZeros(); return; }
      const clientNow = Date.now();
      const etaMs = Math.max(0, targetHalvingTs - (clientNow - serverSkewMs));

      const totalSec = Math.floor(etaMs/1000);
      const days  = Math.floor(totalSec / 86400);
      const hours = Math.floor((totalSec % 86400) / 3600);
      const mins  = Math.floor((totalSec % 3600) / 60);
      const secs  = totalSec % 60;

      el('days').textContent = days;
      el('hours').textContent = hours;
      el('minutes').textContent = mins;
      el('seconds').textContent = secs;
    }

    function setZeros(){
      el('days').textContent = '0';
      el('hours').textContent = '0';
      el('minutes').textContent = '0';
      el('seconds').textContent = '0';
    }

    function showError(msg){
      const e = el('error'); e.textContent = msg; e.style.display = 'block';
    }
    function hideError(){ el('error').style.display = 'none'; }

    (function init(){
      fetchOnce();
      setInterval(renderTimer, 1000);
      resched(REFRESH_DEFAULT);
      window.addEventListener('focus', fetchOnce);
      window.addEventListener('online', fetchOnce);
    })();
  </script>
</body>
</html>
